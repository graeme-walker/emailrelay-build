# src/main/makefile -- generated by ..\emailrelay\libexec\make2nmake

ARCH = x86
CONFIG = release
MBEDTLS_SRC_ROOT = ../../../mbedtls
MBEDTLS_BUILD_ROOT = ../../../mbedtls-$(ARCH)
QT_SRC_ROOT = ../../../qt-$(ARCH)
QT_BUILD_ROOT = ../../../qt-$(ARCH)
QT_MOC = $(QT_BUILD_ROOT)/bin/moc.exe
SRC_ROOT = ../../..\emailrelay
BUILD_ROOT = ../..

all: subdirs libs programs

subdirs:
    cd icon && nmake -f makefile

libs: main.lib

main.lib: serviceimp_win32.obj servicecontrol_win32.obj options.obj submission.obj
    link /lib /nologo /out:main.lib serviceimp_win32.obj servicecontrol_win32.obj options.obj submission.obj

programs: emailrelay-keygen.exe emailrelay.exe emailrelay-submit.exe emailrelay-passwd.exe emailrelay-service.exe emailrelay-textmode.exe

emailrelay-keygen.exe: keygen.obj 
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /SUBSYSTEM:console /out:emailrelay-keygen.exe keygen.obj ../../src/gssl/gsslkeygen.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedtls.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedx509.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedcrypto.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay-keygen.exe SHA256 > emailrelay-keygen.exe.sha256

emailrelay.res: $(SRC_ROOT)/src/main/emailrelay.rc msg00001.bin
    $(RC) -i ../. -i ../.. -i $(SRC_ROOT)/src/glib -i $(SRC_ROOT)/src/gssl -i $(SRC_ROOT)/src/gnet -i $(SRC_ROOT)/src/win32 -i $(SRC_ROOT)/src/gauth -i $(SRC_ROOT)/src/gstore -i $(SRC_ROOT)/src/gsmtp -i $(SRC_ROOT)/src/gpop -i $(SRC_ROOT)/src/gfilters -i $(SRC_ROOT)/src/gverifiers -i $(SRC_ROOT)/src/main/icon -fo emailrelay.res $(SRC_ROOT)/src/main/emailrelay.rc

msg00001.bin: $(SRC_ROOT)/src/main/messages.mc
    mc $(SRC_ROOT)/src/main/messages.mc

emailrelay.exe: winmain.obj winapp.obj winform.obj winmenu.obj licence.obj news.obj commandline.obj configuration.obj legal.obj output.obj run.obj unit.obj emailrelay.res
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /MANIFESTINPUT:$(SRC_ROOT)\src\main\emailrelay.exe.manifest /MANIFESTUAC:no /SUBSYSTEM:windows "/MANIFESTDEPENDENCY:type='win32' name='Microsoft.Windows.Common-Controls' version='6.0.0.0' publicKeyToken='6595b64144ccf1df' language='*' processorArchitecture='*'" /out:emailrelay.exe winmain.obj winapp.obj winform.obj winmenu.obj licence.obj news.obj commandline.obj configuration.obj legal.obj output.obj run.obj unit.obj emailrelay.res ../../src/main/main.lib ../../src/gfilters/gfilters.lib ../../src/gverifiers/gverifiers.lib ../../src/gpop/gpop.lib ../../src/gsmtp/gsmtp.lib ../../src/gstore/gstore.lib ../../src/gauth/gauth.lib ../../src/gnet/gnet.lib ../../src/gssl/gssl.lib ../../src/win32/win32.lib ../../src/glib/glib.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedtls.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedx509.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedcrypto.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay.exe SHA256 > emailrelay.exe.sha256

emailrelay-submit.exe: submit.obj legal.obj 
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /SUBSYSTEM:console /out:emailrelay-submit.exe submit.obj legal.obj ../../src/gstore/gstore.lib ../../src/win32/win32.lib ../../src/glib/glib.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay-submit.exe SHA256 > emailrelay-submit.exe.sha256

emailrelay-passwd.exe: passwd.obj legal.obj 
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /SUBSYSTEM:console /out:emailrelay-passwd.exe passwd.obj legal.obj ../../src/gssl/gssl.lib ../../src/glib/glib.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedtls.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedx509.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedcrypto.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay-passwd.exe SHA256 > emailrelay-passwd.exe.sha256

emailrelay-service.exe: servicewrapper.obj 
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /MANIFESTINPUT:$(SRC_ROOT)\src\main\emailrelay-service.exe.manifest /MANIFESTUAC:no /SUBSYSTEM:console /out:emailrelay-service.exe servicewrapper.obj ../../src/main/main.lib ../../src/glib/glib.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay-service.exe SHA256 > emailrelay-service.exe.sha256

emailrelay-textmode.exe: main.obj commandline.obj configuration.obj legal.obj output.obj run.obj unit.obj 
    link /nologo /RELEASE /DYNAMICBASE /NXCOMPAT /INCREMENTAL:no /OPT:ref /MANIFEST:embed /SUBSYSTEM:console /out:emailrelay-textmode.exe main.obj commandline.obj configuration.obj legal.obj output.obj run.obj unit.obj ../../src/main/main.lib ../../src/gfilters/gfilters.lib ../../src/gverifiers/gverifiers.lib ../../src/gpop/gpop.lib ../../src/gsmtp/gsmtp.lib ../../src/gstore/gstore.lib ../../src/gauth/gauth.lib ../../src/gnet/gnet.lib ../../src/gssl/gssl.lib ../../src/win32/win32.lib ../../src/glib/glib.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedtls.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedx509.lib $(MBEDTLS_BUILD_ROOT)/library/$(CONFIG)/mbedcrypto.lib ws2_32.lib shell32.lib iphlpapi.lib comctl32.lib advapi32.lib user32.lib gdi32.lib user32.lib kernel32.lib
    certutil -hashfile emailrelay-textmode.exe SHA256 > emailrelay-textmode.exe.sha256

CPPFLAGS = /nologo /DGCONFIG_NO_GCONFIG_DEFS /DG_QT_STATIC /EHsc /I. /D"G_SPOOLDIR=c:/emailrelay" /D"G_LOCALEDIR=." /DG_WINDOWS=1 /DWIN32 /D_WINDOWS /DNDEBUG /W4 /WX /MT /O2 /Ob2 /I. /I.. /I$(SRC_ROOT)/src/glib /I$(SRC_ROOT)/src/gssl /I$(SRC_ROOT)/src/gnet /I$(SRC_ROOT)/src/win32 /I$(SRC_ROOT)/src/gauth /I$(SRC_ROOT)/src/gstore /I$(SRC_ROOT)/src/gsmtp /I$(SRC_ROOT)/src/gpop /I$(SRC_ROOT)/src/gfilters /I$(SRC_ROOT)/src/gverifiers /I$(SRC_ROOT)/src/main/icon

commandline.obj: $(SRC_ROOT)/src/main/commandline.cpp
    $(CPP) $(CPPFLAGS) /c $?

configuration.obj: $(SRC_ROOT)/src/main/configuration.cpp
    $(CPP) $(CPPFLAGS) /c $?

keygen.obj: $(SRC_ROOT)/src/main/keygen.cpp
    $(CPP) $(CPPFLAGS) /c $?

legal.obj: $(SRC_ROOT)/src/main/legal.cpp
    $(CPP) $(CPPFLAGS) /c $?

licence.obj: $(SRC_ROOT)/src/main/licence.cpp
    $(CPP) $(CPPFLAGS) /c $?

main.obj: $(SRC_ROOT)/src/main/main.cpp
    $(CPP) $(CPPFLAGS) /c $?

news.obj: $(SRC_ROOT)/src/main/news.cpp
    $(CPP) $(CPPFLAGS) /c $?

options.obj: $(SRC_ROOT)/src/main/options.cpp
    $(CPP) $(CPPFLAGS) /c $?

output.obj: $(SRC_ROOT)/src/main/output.cpp
    $(CPP) $(CPPFLAGS) /c $?

passwd.obj: $(SRC_ROOT)/src/main/passwd.cpp
    $(CPP) $(CPPFLAGS) /c $?

run.obj: $(SRC_ROOT)/src/main/run.cpp
    $(CPP) $(CPPFLAGS) /c $?

servicecontrol_win32.obj: $(SRC_ROOT)/src/main/servicecontrol_win32.cpp
    $(CPP) $(CPPFLAGS) /c $?

serviceimp_win32.obj: $(SRC_ROOT)/src/main/serviceimp_win32.cpp
    $(CPP) $(CPPFLAGS) /c $?

servicewrapper.obj: $(SRC_ROOT)/src/main/servicewrapper.cpp
    $(CPP) $(CPPFLAGS) /c $?

submission.obj: $(SRC_ROOT)/src/main/submission.cpp
    $(CPP) $(CPPFLAGS) /c $?

submit.obj: $(SRC_ROOT)/src/main/submit.cpp
    $(CPP) $(CPPFLAGS) /c $?

unit.obj: $(SRC_ROOT)/src/main/unit.cpp
    $(CPP) $(CPPFLAGS) /c $?

winapp.obj: $(SRC_ROOT)/src/main/winapp.cpp
    $(CPP) $(CPPFLAGS) /c $?

winform.obj: $(SRC_ROOT)/src/main/winform.cpp
    $(CPP) $(CPPFLAGS) /c $?

winmain.obj: $(SRC_ROOT)/src/main/winmain.cpp
    $(CPP) $(CPPFLAGS) /c $?

winmenu.obj: $(SRC_ROOT)/src/main/winmenu.cpp
    $(CPP) $(CPPFLAGS) /c $?


